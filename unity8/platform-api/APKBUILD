# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=platform-api
pkgver=0_git20210824
pkgrel=0
_commit="2af9d75c093c1c5728d630531f8c0b77b993aefb"
pkgdesc="Platform API for system level capabilities"
arch="all"
url='https://github.com/ubports/platform-api'
license="GPL-3.0-only AND LGPL-3.0-only"
depends_dev="process-cpp-dev lomiri-url-dispatcher-dev location-service-dev"
makedepends="$depends_dev cmake cmake-extras dbus-cpp-dev gtest-dev gmock"
source="$pkgname-$_commit.tar.gz::https://github.com/ubports/$pkgname/archive/$_commit.tar.gz"
subpackages="$pkgname-dev"
builddir="$srcdir/$pkgname-$_commit"

build() {
	cmake -B build \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr
	make -C build
}

check() {
	cd build
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	make -C build DESTDIR="$pkgdir" install
}

sha512sums="
3cf778a86c1ab0c9724c4534bdbfc2a35be61c6b87ca505a0bf2b7e7ee1db6459ce49744ba24472a205131095f4b4d3ab911f8d6eda872481212726992f96913  platform-api-2af9d75c093c1c5728d630531f8c0b77b993aefb.tar.gz
"
