# Reference: <https://postmarketos.org/devicepkg>
# Maintainer: Martijn Braam <martijn@brixit.nl>
pkgname=device-pine64-pinephonepro
pkgdesc="PINE64 PinePhone Pro"
pkgver=1.3
pkgrel=0
url="https://postmarketos.org"
license="MIT"
arch="aarch64"
options="!check !archcheck"
depends="
	alsa-ucm-conf>=1.2.6.2
	eg25-manager>=0.4.2
	iw
	linux-pine64-pinephonepro
	mesa-dri-gallium
	postmarketos-base
	"
makedepends="devicepkg-dev"
subpackages="$pkgname-nonfree-firmware:nonfree_firmware"
install="
	$pkgname.post-install
	$pkgname.post-upgrade
	"
source="
	deviceinfo
	extlinux.conf
	ucm/HiFi.conf
	ucm/PinePhonePro.conf
	ucm/VoiceCall.conf
	"

build() {
	devicepkg_build $startdir $pkgname
}

package() {
	devicepkg_package $startdir $pkgname
	install -D -m644 "$srcdir"/extlinux.conf \
		"$pkgdir"/boot/extlinux/extlinux.conf

	install -Dm644 -t "$pkgdir"/usr/share/alsa/ucm2/conf.d/simple-card \
		"$srcdir"/PinePhonePro.conf \
		"$srcdir"/HiFi.conf \
		"$srcdir"/VoiceCall.conf
}

nonfree_firmware() {
	pkgdesc="Wifi, Bluetooth and video-out firmware"
	depends="
		firmware-pine64-pinebookpro
		linux-firmware-rtlwifi
		linux-firmware-rtl_bt
		firmware-pine64-rtl8723bt
		firmware-pine64-ov5640
		"
	mkdir "$subpkgdir"
}

sha512sums="
9ccdd1f581cbf2ed3f969ac18dae307fe9edecf5979ed4dcc8544f93e94bd2bd5713c79786e84e648b04ba80f4b44942b17ffe31a4e9c5c0298d1d79c82d5369  deviceinfo
c34ba2ec600311fe0ccc19656a2456ef72be4d99e8af84e72f8bbbc2cfa233134f12db4506975d0c43f1b842a73957f9ca13f9207606a1ddc095544fa3c8d45b  extlinux.conf
ac22c856af81d00aa6a349b68cf9e8645bf38277d9aafd07f1f46f5f932f48d37b9dfdcc8772fff4027f914c9b4c3b4a11c51bd9f2aa1abbc53abd3f54adb818  HiFi.conf
c57dae885c9a5f366f18b38a3ce3e21627baaf014724537eced9e8d6ac3ca61ade42b9fcf84db350b1e64742760e8cf4fe10639d41052387927238e85c3c4769  PinePhonePro.conf
e978876bda8874e30df75c80554ccbbc0dd202c852ecae0b5c1a0d845402a630962afc2691c6f7d5f478fb0e4be045af4ef62ad0b1ce77f62fe2f155dc0a9cff  VoiceCall.conf
"
